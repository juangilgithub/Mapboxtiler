<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maptiler Weather Layers</title>
    
    <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.5.1/maptiler-sdk.umd.min.js"></script>
    <link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.5.1/maptiler-sdk.css" rel="stylesheet" />
    <script src="https://cdn.maptiler.com/maptiler-weather/v2.2.0/maptiler-weather.umd.min.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #variable-name {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            font-weight: 500;
            color: white;
            text-shadow: 0px 0px 10px rgba(0, 0, 0, 0.7);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            text-transform: capitalize;
        }
        #buttons {
            position: fixed;
            top: 40px;
            right: 10px;
            z-index: 100;
            background: transparent;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .button {
            color: white;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        .button:hover, .button.active {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.7);
        }
    </style>
</head>
<body>
    <div id="variable-name">Detailed Forecast</div>
    <div id="map"></div>
    <ul id="buttons">
        <li id="pressure" class="button">Pressure</li>
        <li id="temperature" class="button">Temperature</li>
        <li id="wind" class="button">Wind</li>
    </ul>

    <script>
        maptilersdk.config.apiKey = 'BMRZ94nyuUi40edFPorX';

        const weatherLayers = {
            "pressure": {
                "layer": null,
                "value": "value",
                "units": " hPa"
            },
            "temperature": {
                "layer": null,
                "value": "value",
                "units": "Â°C"
            },
            "wind": {
                "layer": null,
                "value": "speedMetersPerSecond",
                "units": " m/s"
            }
        };

        const map = new maptilersdk.Map({
            container: 'map',
            style: maptilersdk.MapStyle.DATAVIZ.DARK,
            zoom: 4,
            center: [-3.7038, 40.4168],
            hash: true,
            navigationControl: false,
            geolocateControl: false,
        });

        let activeLayer = null;

        map.on('load', function () {
            initWeatherMap("pressure"); // ðŸ“Œ Cargar solo Pressure al inicio
        });

        document.getElementById('buttons').addEventListener('click', function (event) {
            changeWeatherLayer(event.target.id);
        });

        function changeWeatherLayer(type) {
            if (type !== activeLayer) {
                if (map.getLayer(activeLayer)) {
                    const activeWeatherLayer = weatherLayers[activeLayer]?.layer;
                    if (activeWeatherLayer) {
                        map.setLayoutProperty(activeLayer, 'visibility', 'none');
                    }
                }
                activeLayer = type;
                const weatherLayer = weatherLayers[activeLayer].layer || createWeatherLayer(activeLayer);

                if (map.getLayer(activeLayer)) {
                    map.setLayoutProperty(activeLayer, 'visibility', 'visible');
                } else {
                    map.addLayer(weatherLayer, 'Water');
                }

                activateButton(activeLayer);
                changeLayerLabel(activeLayer);
                return weatherLayer;
            }
        }

        function activateButton(activeLayer) {
            document.querySelectorAll('.button').forEach(btn => {
                btn.classList.toggle('active', btn.id === activeLayer);
            });
        }

        function createWeatherLayer(type) {
            let weatherLayer;
            switch (type) {
                case 'pressure':
                    weatherLayer = new maptilerweather.PressureLayer({ id: 'pressure' });
                    break;
                case 'temperature':
                    weatherLayer = new maptilerweather.TemperatureLayer({ id: 'temperature' });
                    break;
                case 'wind':
                    weatherLayer = new maptilerweather.WindLayer({ id: 'wind' });
                    break;
            }

            weatherLayer.on("sourceReady", event => {
                weatherLayers[type].layer = weatherLayer;
            });

            return weatherLayer;
        }

        function changeLayerLabel(type) {
            const labels = {
                "pressure": "Pressure",
                "temperature": "Temperature",
                "wind": "Wind"
            };
            document.getElementById("variable-name").innerText = labels[type];
        }

        function initWeatherMap(type) {
            changeWeatherLayer(type);
        }
    </script>
</body>
</html>

